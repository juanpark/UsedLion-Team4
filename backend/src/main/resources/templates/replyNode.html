<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <script>
    function openReportModal() {
      document.getElementById("reportModal").style.display = "block";
      document.getElementById("modalBackdrop").style.display = "block";
    }

    function closeReportModal() {
      document.getElementById("reportModal").style.display = "none";
      document.getElementById("modalBackdrop").style.display = "none";
    }
  </script>
  <body>
    <th:block th:fragment="reply(node, depth,postId)">
      <div th:style="'margin-left:' + (${depth} * 40) + 'px'">
        <p>
          <strong>
            <a
              th:href="@{/user/{profileId}(profileId=${node.reply.profileId})}"
              th:text="${node.reply.username}"
              >작성자</a
            >
          </strong>
          <span
            th:text="${#temporals.format(node.reply.date, 'yyyy-MM-dd HH:mm')}"
            >날짜</span
          >
          <button type="button" onclick="openReportModal()">신고하기</button><br />
          <br />
          <strong th:text="${node.reply.content}">댓글 내용</strong>
          <form
            th:action="@{/reply/{postId}/{parentReplyId}(postId=${postId}, parentReplyId=${node.reply.replyId})}"
            method="POST"
          >
            <input
              type="text"
              name="content"
              placeholder="대댓글을 입력하세요"
              required
            />
            <button type="submit">댓글 달기</button>
          </form>
        </p>
        <div id="reportModal" class="modal" style="display:none; position:fixed; top:30%; left:50%; transform:translate(-50%, -50%); background:white; padding:20px; border:1px solid #ccc; z-index:1000;">
          <form th:action="@{/report/{postId}/{profileId}(postId=${postId}, profileId=${node.reply.profileId})}" method="post">
            <h3>신고 사유 입력</h3>
            <textarea name="reason" rows="4" cols="40" placeholder="내용" required></textarea><br><br>
            <button type="submit">제출</button>
            <button type="button" onclick="closeReportModal()">취소</button>
          </form>
        </div>
      </div>
      <th:block
        th:if="${node.children != null}"
        th:each="child : ${node.children}"
      >
        <div
          th:replace="~{replyNode :: reply(${child}, ${depth + 1}, ${postId})}"
        ></div>
      </th:block>
    </th:block>
  </body>
</html>
