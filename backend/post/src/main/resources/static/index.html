<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê²Œì‹œíŒ</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>

<h1>ğŸ“‹ ê²Œì‹œíŒ</h1>

<!-- ê¸€ ì‘ì„± -->
<h3>ìƒˆ ê¸€ ì‘ì„±</h3>
<input type="text" id="titleInput" placeholder="ì œëª©"><br>
<textarea id="contentInput" placeholder="ë‚´ìš©"></textarea><br>
<button onclick="createPost()">ì‘ì„±</button>

<!-- ê²€ìƒ‰ -->
<h3>ê²Œì‹œê¸€ ê²€ìƒ‰</h3>
<input type="text" id="searchInput" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥">
<button onclick="searchPosts()">ê²€ìƒ‰</button>
<button onclick="resetSearch()">ë˜ëŒë¦¬ê¸°</button>

<!-- ê²Œì‹œê¸€ ëª©ë¡ -->
<h3>ğŸ“ƒ ê²Œì‹œê¸€ ëª©ë¡</h3>
<div id="postList"></div>

<script>
function fetchPosts() {
  axios.get("http://localhost:8080/posts")
    .then(response => displayPosts(response.data))
    .catch(error => console.error("ëª©ë¡ ì¡°íšŒ ì‹¤íŒ¨:", error));
}

function displayPosts(posts) {
  const postList = document.getElementById("postList");
  postList.innerHTML = "";
  if (posts.length === 0) {
    postList.innerHTML = "<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
    return;
  }
  posts.forEach(post => {
    const div = document.createElement("div");
    div.innerHTML = `
      <h4>${post.title}</h4>
      <p>${post.content}</p>
      <p>ğŸ‘ ${post.likes}</p>
      <button onclick="likePost(${post.id})">ì¶”ì²œ</button>
      <hr>
    `;
    postList.appendChild(div);
  });
}

function createPost() {
  const title = document.getElementById("titleInput").value;
  const content = document.getElementById("contentInput").value;

  axios.post("http://localhost:8080/posts", { title, content })
    .then(() => {
      document.getElementById("titleInput").value = "";
      document.getElementById("contentInput").value = "";
      fetchPosts();
    })
    .catch(error => console.error("ê¸€ ì‘ì„± ì‹¤íŒ¨:", error));
}

function likePost(id) {
  axios.post(`http://localhost:8080/posts/${id}/like`)
    .then(() => fetchPosts())
    .catch(error => console.error("ì¶”ì²œ ì‹¤íŒ¨:", error));
}

function searchPosts() {
  const keyword = document.getElementById("searchInput").value.trim();
  if (!keyword) {
    alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
    return;
  }

  axios.get("http://localhost:8080/posts/search", { params: { keyword } })
    .then(response => displayPosts(response.data))
    .catch(error => console.error("ê²€ìƒ‰ ì‹¤íŒ¨:", error));
}

function resetSearch() {
  document.getElementById("searchInput").value = "";
  fetchPosts(); // ì „ì²´ ê¸€ ë‹¤ì‹œ í‘œì‹œ
}

// ì´ˆê¸° ë¡œë”© ì‹œ ì „ì²´ ê¸€ í‘œì‹œ
fetchPosts();
</script>

</body>
</html>
